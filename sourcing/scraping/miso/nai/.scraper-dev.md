---
# Scraper Configuration - MISO Net Actual Interchange

# Required fields
data_source: MISO
data_type: net_actual_interchange
collection_method: HTTP/REST API
data_format: JSON
update_frequency: Real-time (5-min)
historical_support: no
authentication: None

# HTTP/REST API specific
api_base_url: https://public-api.misoenergy.org
api_endpoint: /api/Interchange/GetNai
api_query_params: none
api_rate_limit: No known limits

# Additional metadata
dgroup: miso_net_actual_interchange
s3_path: sourcing/miso/net_actual_interchange/

# Infrastructure version
infrastructure_version: 1.3.0
last_updated: 2025-12-05
---

# MISO Net Actual Interchange (NAI) Scraper Configuration

## Data Source Details

**Organization**: MISO (Midcontinent Independent System Operator)
**API Type**: Public REST API
**Authentication**: None required
**API Endpoint**: https://public-api.misoenergy.org/api/Interchange/GetNai

## Collection Strategy

This scraper collects real-time net actual interchange data from MISO's public API. Each execution fetches the current state of all tie flows between MISO and neighboring control areas.

### What is Net Actual Interchange?

Net Actual Interchange represents the actual power flows (in MW) across interconnection points between MISO and adjacent control areas. The data shows:

- **Positive values**: Power flowing INTO MISO from the neighboring area
- **Negative values**: Power flowing OUT OF MISO to the neighboring area

### Typical Tie Flows

The API typically returns 5-15 tie flows including connections to:
- Southwest Power Pool (SPP)
- PJM Interconnection
- Tennessee Valley Authority (TVA)
- Louisville Gas and Electric (LGEE)
- Associated Electric Cooperative (AECI)
- And other neighboring entities

## Scheduling Recommendations

- **Production**: Run every 5 minutes
- **Development**: Run every 15 minutes
- **Testing**: Manual execution as needed

## Response Structure

```json
{
  "data": [
    {
      "RefId": "MISO_SPP_1",
      "TieFlowName": "MISO - Southwest Power Pool",
      "TieFlowValue": 1234.56,
      "Timestamp": "2025-12-05T14:30:00Z"
    },
    ...
  ]
}
```

### Field Descriptions

- **RefId**: Unique identifier for the tie flow (e.g., "MISO_SPP_1")
- **TieFlowName**: Descriptive name of the interconnection
- **TieFlowValue**: Power flow in MW (positive = into MISO, negative = out of MISO)
- **Timestamp**: ISO 8601 timestamp in UTC

## Validation Rules

1. Response must be a dictionary with 'data' key
2. 'data' must be a list with at least 1 element
3. Each tie flow must contain: RefId, TieFlowName, TieFlowValue, Timestamp
4. TieFlowValue must be numeric (can be positive, negative, or zero)
5. TieFlowName must be a non-empty string
6. Timestamp must be valid ISO 8601 format

## Storage

- **S3 Path**: `s3://{bucket}/sourcing/miso_net_actual_interchange/{date}/nai_{timestamp}.json.gz`
- **Compression**: gzip
- **Deduplication**: Redis hash-based
- **Retention**: Indefinite (subject to S3 lifecycle policies)

## Monitoring

- Alert if no new data for 30 minutes
- Alert if validation failure rate exceeds 5%
- Monitor duplicate rate (normal: <5%)
- Track API response times (normal: <5 seconds)

## Usage Examples

### Basic Execution

```bash
python scraper_miso_nai.py \
  --s3-bucket scraper-testing \
  --aws-profile localstack
```

### Production Execution

```bash
python scraper_miso_nai.py \
  --s3-bucket production-data \
  --environment prod \
  --redis-host redis.production.com \
  --kafka-connection-string kafka://broker:9092
```

## Expected Data Volume

- **Update Frequency**: Every 5 minutes
- **Tie Flows per Update**: 5-15 typically
- **Data Size**: ~500-1500 bytes per update (uncompressed)
- **Daily Volume**: ~288 updates = ~150-450 KB/day (uncompressed)

## Error Handling

The scraper handles:
- Network timeouts (30 second timeout)
- HTTP errors (4xx, 5xx status codes)
- Invalid JSON responses
- Missing required fields
- Invalid data types
- Duplicate content (skipped via Redis)

## Dependencies

- Python 3.8+
- requests
- boto3
- redis
- click

## Related Documentation

- MISO Public API Documentation: https://www.misoenergy.org/markets-and-operations/real-time--market-data/
- Collection Framework: `/sourcing/infrastructure/collection_framework.py`
- Hash Registry: `/sourcing/infrastructure/hash_registry.py`
